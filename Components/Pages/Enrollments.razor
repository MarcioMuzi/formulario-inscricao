@page "/enrollments"
@rendermode InteractiveServer
@using WebApp.Data
@using Microsoft.EntityFrameworkCore
@using MudBlazor
@inject AppDbContext Db

<MudPaper Class="p-6">
  <MudText Typo="Typo.h4" Class="mb-4">Inscrições (últimas 20)</MudText>

  @if (_items?.Count == 0)
  {
    <MudAlert Severity="Severity.Info">Nenhuma inscrição encontrada.</MudAlert>
  }
  else
  {
    <MudText Typo="Typo.body2" Class="mb-2">Total exibido: @_items.Count</MudText>

    <MudTable Items="_items" Dense="true" Hover="true">
      <HeaderContent>
        <MudTh style="width:80px">ID</MudTh>
        <MudTh>Nome</MudTh>
        <MudTh>E-mail</MudTh>
        <MudTh style="width:160px">Curso</MudTh>
        <MudTh style="width:200px">Criado em</MudTh>
      </HeaderContent>
      <RowTemplate>
        <MudTd DataLabel="ID">@context.Id</MudTd>
        <MudTd DataLabel="Nome">@context.FullName</MudTd>
        <MudTd DataLabel="E-mail">@context.Email</MudTd>
        <MudTd DataLabel="Curso">@((string.IsNullOrWhiteSpace(context.Course) ? "-" : context.Course))</MudTd>
        <MudTd DataLabel="Criado em">@context.CreatedAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</MudTd>
      </RowTemplate>
    </MudTable>
  }
</MudPaper>

@code {
  List<Enrollment> _items = new();

  protected override async Task OnInitializedAsync()
  {
    _items = await Db.Enrollments
      .OrderByDescending(e => e.Id)
      .Take(20)
      .ToListAsync();
  }
}
